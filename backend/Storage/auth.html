
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Login / Register</title>
  <style>
    body { font-family: sans-serif; max-width: 400px; margin: auto; padding: 2rem; }
    input, button { display: block; margin: 0.5rem 0; padding: 0.5rem; width: 100%; }
    .message { margin-top: 1rem; color: green; }
    .error { color: red; }
  </style>
</head>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const loggedInUser = localStorage.getItem("loggedInUser");
    if (loggedInUser) {
      //window.location.href = "user.html";
    }
  });
</script>


<body>

  <h2>Register</h2>


    <form id="registerForm">
      <input type="text" name="username" placeholder="Username" required />
      <input type="password" name="password" placeholder="Password" required />
      <button type="submit">Register</button>
    </form>


  <h2>Login</h2>


    <form id="loginForm">
      <input type="text" name="username" placeholder="Username" required />
      <input type="password" name="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>

  <div class="message" id="message"></div>

  <script>
    const registerForm = document.getElementById('registerForm');
    const loginForm = document.getElementById('loginForm');
    const message = document.getElementById('message');



    // Register form submission
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(registerForm);
      const payload = {
        username: formData.get('username'),
        password: formData.get('password')
      };

      const res = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      message.textContent = data.message || data.error;
      message.className = res.ok ? 'message' : 'message error';
    });



    // Login form submission
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(loginForm);
      const payload = {
        username: formData.get('username'),
        password: formData.get('password')
      };

      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (res.ok) {
        // Save token and username
        localStorage.setItem('token', data.token);
        localStorage.setItem('username', payload.username);
        // Redirect to user homepage
        window.location.href = '/user.html';
      } else {
        message.textContent = data.error || 'Login failed';
        message.className = 'message error';
      }
    });


  </script>

  
</body>
</html>

<!--
Login and registration are handled via fetch requests to /api/register and /api/login.
- Registration: Submits username and password, displays server response.
- Login: Submits username and password, stores token and username in localStorage on success, then redirects to /user.html.
If the backend endpoints are implemented correctly, both forms should be functional.
-->